## 유저플로우 #1: 회원가입

### 1. 입력
- 사용자가 회원가입 페이지(`/signup`) 접근
- Supabase 템플릿 UI를 통해 이메일/비밀번호 입력 및 회원가입 버튼 클릭

### 2. 처리
1. Supabase Auth 템플릿이 회원가입 자동 처리
2. 회원가입 성공 시:
   - 신규 사용자 UUID 획득
   - 프로필 테이블에 신규 레코드 생성
     - user_id: 사용자 UUID
     - email: 입력된 이메일
     - nickname: 이메일 기반 초기 닉네임 (예: 이메일 @ 앞부분)
     - created_at: 현재 시각
   - 프로필 생성 실패 시 → 오류 처리

### 3. 출력
- **회원가입 실패 시**: Supabase 템플릿 기본 오류 메시지 표시
- **프로필 생성 실패 시**: 오류 메시지 표시
- **회원가입 성공 시**: 로그인 페이지(`/login`)로 리다이렉트

---

## 유저플로우 #2: 로그인

### 1. 입력
- 사용자가 로그인 페이지(`/login`) 접근
- Supabase 템플릿 UI를 통해 이메일/비밀번호 입력 및 로그인 버튼 클릭

### 2. 처리
1. Supabase Auth 템플릿이 로그인 자동 처리
2. 로그인 성공 시 세션 생성

### 3. 출력
- **로그인 실패 시**: Supabase 템플릿 기본 오류 메시지 표시
- **로그인 성공 시**: 채팅방 목록 페이지(`/`)로 리다이렉트

---

## 유저플로우 #3: 채팅방 목록 페이지 진입 및 조회

### 1. 입력
- 사용자가 채팅방 목록 페이지(`/`) 접근

### 2. 처리
1. 사용자 인증 상태 확인 (Supabase Auth 세션 확인)
2. 데이터베이스에서 모든 채팅방 조회
   - 최종 수정일(updated_at) 기준 내림차순 정렬
   - 각 채팅방의 생성자 정보 조인하여 닉네임 포함
3. 조회 실패 시 → 빈 목록 또는 오류 상태로 처리
4. Polling 타이머 시작 (10초 간격)

### 3. 출력
- **상단 헤더**:
  - 'VMC Chat' 로고 표시
  - 로그인 사용자: 사용자 이메일, '마이페이지' 버튼, '로그아웃' 버튼 표시
  - 비로그인 사용자: '로그인' 버튼만 표시
- **채팅방 목록**:
  - 각 채팅방을 카드 형태로 표시
  - 카드 내용: 채팅방 이름, 생성자 닉네임, 최종 수정 시간
  - 채팅방이 없는 경우: 빈 목록 상태 표시
- **하단 액션**:
  - 로그인 사용자: '채팅방 추가하기' 버튼 표시
  - 비로그인 사용자: 버튼 미표시
- **조회 실패 시**: 오류 메시지 표시

---

## 유저플로우 #4: 채팅방 목록 Polling

### 1. 입력
- 10초 타이머 만료 (자동 트리거)

### 2. 처리
1. 데이터베이스에서 모든 채팅방 재조회
   - 최종 수정일(updated_at) 기준 내림차순 정렬
   - 각 채팅방의 생성자 정보 조인하여 닉네임 포함
2. 기존 목록과 비교하여 변경사항 확인
3. 조회 실패 시 → 기존 목록 유지
4. 다음 Polling 타이머 재시작 (10초)

### 3. 출력
- **변경사항 있는 경우**: 채팅방 목록 갱신 (순서 변경, 새 채팅방 추가 등)
- **변경사항 없는 경우**: 화면 유지
- **조회 실패 시**: 기존 목록 유지, 콘솔에 오류 로그 (사용자에게는 미표시)

---

## 유저플로우 #5: 채팅방 카드 클릭

### 1. 입력
- 사용자가 채팅방 목록에서 특정 채팅방 카드 클릭

### 2. 처리
1. 클릭된 채팅방의 ID 추출
2. 채팅방 페이지로 라우팅 준비

### 3. 출력
- 채팅방 페이지(`/room/:roomId`)로 이동

---

## 유저플로우 #6: 로그아웃 (채팅방 목록 페이지)

### 1. 입력
- 로그인 사용자가 채팅방 목록 페이지에서 '로그아웃' 버튼 클릭

### 2. 처리
1. Supabase Auth 로그아웃 API 호출
2. 세션 정보 삭제
3. 로그아웃 실패 시 → 오류 처리

### 3. 출력
- **로그아웃 성공 시**: 
  - 페이지 새로고침 (채팅방 목록 페이지 유지, 비로그인 상태로 UI 변경)
  - 헤더에서 이메일, 마이페이지, 로그아웃 버튼 제거
  - '로그인' 버튼 표시
  - '채팅방 추가하기' 버튼 제거
- **로그아웃 실패 시**: 오류 메시지 표시

---

## 유저플로우 #7: 채팅방 생성 페이지 진입

### 1. 입력
- 사용자가 채팅방 목록 페이지에서 '채팅방 추가하기' 버튼 클릭

### 2. 처리
1. 사용자 인증 상태 확인
2. 비로그인 상태인 경우 → 처리 중단, 출력 단계로 이동
3. 로그인 상태인 경우 → 채팅방 생성 페이지로 라우팅

### 3. 출력
- **비로그인 상태**: 로그인 페이지(`/login`)로 리다이렉트
- **로그인 상태**: 채팅방 생성 페이지(`/create-room`)로 이동
  - '뒤로가기' 버튼 표시
  - 채팅방 이름 입력 필드 표시 (최대 100자)
  - '추가' 버튼 표시
  - '취소' 버튼 표시

---

## 유저플로우 #8: 채팅방 생성

### 1. 입력
- 채팅방 생성 페이지에서 채팅방 이름 입력
- '추가' 버튼 클릭

### 2. 처리
1. 입력값 유효성 검증
   - 빈 값 여부 확인
   - 100자 이하 확인
2. 유효성 검증 실패 시 → 처리 중단, 출력 단계로 이동
3. 유효성 검증 성공 시:
   - 현재 로그인 사용자 정보 획득
   - 데이터베이스에 새 채팅방 생성
     - name: 입력된 채팅방 이름
     - creator_id: 현재 사용자 UUID
     - created_at: 현재 시각
     - updated_at: 현재 시각
   - 생성 실패 시 → 처리 중단, 출력 단계로 이동
   - 생성 성공 시 → 새 채팅방 ID 획득

### 3. 출력
- **유효성 검증 실패 시**: 입력 필드에 오류 메시지 표시
- **생성 실패 시**: 오류 메시지 표시
- **생성 성공 시**: 생성된 채팅방 페이지(`/room/:newRoomId`)로 이동

---

## 유저플로우 #9: 채팅방 생성 취소

### 1. 입력
- 채팅방 생성 페이지에서 '취소' 버튼 또는 '뒤로가기' 버튼 클릭

### 2. 처리
1. 입력된 데이터 폐기
2. 채팅방 목록 페이지로 라우팅

### 3. 출력
- 채팅방 목록 페이지(`/`)로 이동

---

## 유저플로우 #10: 채팅방 페이지 진입

### 1. 입력
- 사용자가 채팅방 페이지(`/room/:roomId`) 접근

### 2. 처리
1. URL에서 채팅방 ID 추출
2. 사용자 인증 상태 확인
3. 데이터베이스에서 채팅방 정보 조회
   - 채팅방이 존재하지 않는 경우 → 처리 중단, 출력 단계로 이동
4. 데이터베이스에서 해당 채팅방의 모든 메시지 조회
   - 전송 시간(created_at) 기준 오름차순 정렬
   - 각 메시지의 발신자 정보 조인하여 닉네임 포함
   - 답장 대상 메시지 정보 포함 (있는 경우)
   - 각 메시지의 좋아요 수 집계
5. 로그인 사용자인 경우:
   - 각 메시지에 대한 본인의 좋아요 여부 확인
6. 메시지 조회 실패 시 → 빈 목록으로 처리
7. Polling 타이머 시작 (3-5초 간격)

### 3. 출력
- **채팅방이 존재하지 않는 경우**: 
  - 404 오류 메시지 표시
  - 채팅방 목록으로 돌아가기 버튼 표시
- **정상 진입 시**:
  - 상단에 채팅방 제목 표시
  - 메시지 목록 표시:
    - 각 메시지: 발신자 닉네임, 내용, 전송 시간, 좋아요 수
    - 본인 메시지: 오른쪽 정렬
    - 타인 메시지: 왼쪽 정렬
    - 답장 메시지: 답장 대상 정보 함께 표시
  - 로그인 사용자:
    - 각 메시지에 '좋아요' 버튼 표시 (본인이 좋아요 누른 경우 활성화 상태)
    - 각 메시지에 '답장' 버튼 표시
    - 본인 메시지에 '삭제' 버튼 표시
  - 하단에 메시지 입력 영역과 '전송' 버튼 표시
  - 메시지가 없는 경우: 빈 채팅방 상태 표시

---

## 유저플로우 #11: 채팅방 메시지 Polling

### 1. 입력
- 3-5초 타이머 만료 (자동 트리거)

### 2. 처리
1. 데이터베이스에서 해당 채팅방의 모든 메시지 재조회
   - 전송 시간(created_at) 기준 오름차순 정렬
   - 각 메시지의 발신자 정보 조인
   - 답장 대상 메시지 정보 포함
   - 각 메시지의 좋아요 수 집계
2. 로그인 사용자인 경우:
   - 각 메시지에 대한 본인의 좋아요 여부 확인
3. 기존 메시지 목록과 비교하여 변경사항 확인
4. 조회 실패 시 → 기존 목록 유지
5. 다음 Polling 타이머 재시작 (3-5초)

### 3. 출력
- **새 메시지가 있는 경우**: 
  - 메시지 목록에 새 메시지 추가
  - 스크롤을 최하단으로 자동 이동 (선택적)
- **기존 메시지의 좋아요 수 변경된 경우**: 해당 메시지의 좋아요 수 갱신
- **메시지 삭제된 경우**: 해당 메시지 목록에서 제거
- **변경사항 없는 경우**: 화면 유지
- **조회 실패 시**: 기존 목록 유지, 콘솔에 오류 로그

---

## 유저플로우 #12: 메시지 전송

### 1. 입력
- 로그인 사용자가 메시지 입력 영역에 텍스트 입력
- '전송' 버튼 클릭 또는 Enter 키 입력

### 2. 처리
1. 입력값 유효성 검증
   - 빈 값 또는 공백만 있는 경우 확인
2. 유효성 검증 실패 시 → 처리 중단
3. 유효성 검증 성공 시:
   - 현재 로그인 사용자 정보 획득
   - 답장 모드 여부 확인 (답장 대상 메시지 ID 존재 여부)
   - 데이터베이스에 새 메시지 생성
     - room_id: 현재 채팅방 ID
     - sender_id: 현재 사용자 UUID
     - content: 입력된 메시지 내용
     - created_at: 현재 시각
     - reply_to_id: 답장 대상 메시지 ID (답장 모드인 경우)
   - 메시지 생성 실패 시 → 처리 중단, 출력 단계로 이동
   - 메시지 생성 성공 시:
     - 채팅방의 updated_at을 현재 시각으로 갱신
     - 즉시 메시지 목록 재조회 (Polling 실행)
     - 답장 모드 상태 초기화

### 3. 출력
- **유효성 검증 실패 시**: 아무 동작 없음
- **메시지 생성 실패 시**: 오류 메시지 표시
- **메시지 생성 성공 시**:
  - 메시지 입력창 초기화 (빈 값으로)
  - 답장 모드인 경우: 답장 대상 표시 영역 제거
  - 메시지 목록에 새 메시지 즉시 표시
  - 스크롤을 최하단으로 자동 이동 (선택적)

---

## 유저플로우 #13: 메시지 좋아요 토글

### 1. 입력
- 로그인 사용자가 특정 메시지의 '좋아요' 버튼 클릭

### 2. 처리
1. 현재 로그인 사용자 정보 획득
2. 클릭된 메시지 ID 추출
3. 데이터베이스에서 해당 메시지에 대한 본인의 좋아요 존재 여부 확인
4. **좋아요가 이미 존재하는 경우** (좋아요 취소):
   - 데이터베이스에서 좋아요 레코드 삭제
   - 삭제 실패 시 → 처리 중단, 출력 단계로 이동
5. **좋아요가 존재하지 않는 경우** (좋아요 추가):
   - 데이터베이스에 새 좋아요 레코드 생성
     - message_id: 클릭된 메시지 ID
     - user_id: 현재 사용자 UUID
     - created_at: 현재 시각
   - 생성 실패 시 → 처리 중단, 출력 단계로 이동
6. 성공 시: 해당 메시지의 좋아요 수 재집계

### 3. 출력
- **좋아요 취소 성공 시**: 
  - 좋아요 버튼 비활성화 상태로 변경
  - 좋아요 수 1 감소 표시
- **좋아요 추가 성공 시**: 
  - 좋아요 버튼 활성화 상태로 변경
  - 좋아요 수 1 증가 표시
- **실패 시**: 오류 메시지 표시, 버튼 상태 원복

---

## 유저플로우 #14: 메시지 답장 시작

### 1. 입력
- 로그인 사용자가 특정 메시지의 '답장' 버튼 클릭

### 2. 처리
1. 클릭된 메시지 정보 추출 (메시지 ID, 내용, 발신자 닉네임)
2. 답장 모드 상태 활성화
3. 답장 대상 메시지 정보 저장

### 3. 출력
- 메시지 입력 영역 상단에 답장 대상 표시 영역 생성
  - 답장 대상 메시지의 발신자 닉네임 표시
  - 답장 대상 메시지 내용 일부 표시 (길면 축약)
  - 'X' 취소 버튼 표시
- 메시지 입력창에 포커스 이동

---

## 유저플로우 #15: 메시지 답장 취소

### 1. 입력
- 답장 모드에서 'X' 취소 버튼 클릭

### 2. 처리
1. 답장 모드 상태 비활성화
2. 답장 대상 메시지 정보 초기화

### 3. 출력
- 답장 대상 표시 영역 제거
- 메시지 입력창 상태는 유지 (입력된 텍스트 보존)

---

## 유저플로우 #16: 메시지 답장 전송

### 1. 입력
- 답장 모드에서 메시지 입력
- '전송' 버튼 클릭 또는 Enter 키 입력

### 2. 처리
- **유저플로우 #12 (메시지 전송)과 동일**
- 단, reply_to_id에 답장 대상 메시지 ID 포함

### 3. 출력
- **유저플로우 #12 (메시지 전송)과 동일**
- 추가로 답장 대상 표시 영역 제거

---

## 유저플로우 #17: 메시지 삭제

### 1. 입력
- 로그인 사용자가 본인이 작성한 메시지의 '삭제' 버튼 클릭

### 2. 처리
1. 현재 로그인 사용자 정보 획득
2. 클릭된 메시지 ID 추출
3. 메시지 작성자 확인
   - 작성자가 본인이 아닌 경우 → 처리 중단, 출력 단계로 이동
4. 삭제 확인 (선택적)
5. 데이터베이스에서 해당 메시지 삭제
   - 삭제 실패 시 → 처리 중단, 출력 단계로 이동
   - 삭제 성공 시: 메시지 목록에서 제거

### 3. 출력
- **권한 없음 시**: 오류 메시지 표시 (발생하지 않아야 함)
- **삭제 실패 시**: 오류 메시지 표시
- **삭제 성공 시**: 
  - 메시지 목록에서 해당 메시지 즉시 제거
  - 삭제 완료 피드백 (선택적)

---

## 유저플로우 #18: 비로그인 사용자 메시지 입력 시도

### 1. 입력
- 비로그인 사용자가 채팅방 페이지에서 메시지 입력 영역 클릭

### 2. 처리
1. 사용자 인증 상태 확인
2. 비로그인 상태 확인
3. 로그인 페이지로 라우팅 준비

### 3. 출력
- 로그인 페이지(`/login`)로 리다이렉트
- 로그인 후 원래 채팅방으로 돌아올 수 있도록 리다이렉트 경로 저장 (선택적)

---

## 유저플로우 #19: 마이페이지 진입

### 1. 입력
- 사용자가 마이페이지(`/mypage`) 접근 또는 채팅방 목록 페이지에서 '마이페이지' 버튼 클릭

### 2. 처리
1. 사용자 인증 상태 확인
2. 비로그인 상태인 경우 → 처리 중단, 출력 단계로 이동
3. 로그인 상태인 경우:
   - 현재 사용자 정보 획득
   - 데이터베이스에서 사용자 프로필 조회
     - email, nickname, created_at
   - 조회 실패 시 → 처리 중단, 출력 단계로 이동

### 3. 출력
- **비로그인 상태**: 로그인 페이지(`/login`)로 리다이렉트
- **프로필 조회 실패 시**: 오류 메시지 표시
- **정상 진입 시**:
  - 이메일 표시
  - 현재 닉네임 표시
  - 가입일 표시
  - 새 닉네임 입력 필드 표시
  - '변경 사항 저장' 버튼 표시
  - '로그아웃' 버튼 표시

---

## 유저플로우 #20: 닉네임 변경

### 1. 입력
- 마이페이지에서 새 닉네임 입력 필드에 텍스트 입력
- '변경 사항 저장' 버튼 클릭

### 2. 처리
1. 입력값 유효성 검증
   - 빈 값 또는 공백만 있는 경우 확인
   - 최대 길이 확인 (선택적)
2. 유효성 검증 실패 시 → 처리 중단, 출력 단계로 이동
3. 유효성 검증 성공 시:
   - 현재 로그인 사용자 정보 획득
   - 데이터베이스에서 사용자 프로필의 nickname 필드 업데이트
   - 업데이트 실패 시 → 처리 중단, 출력 단계로 이동
   - 업데이트 성공 시: 새로운 닉네임 정보 획득

### 3. 출력
- **유효성 검증 실패 시**: 입력 필드에 오류 메시지 표시
- **업데이트 실패 시**: 오류 메시지 표시
- **업데이트 성공 시**:
  - 화면에 표시된 현재 닉네임을 새 닉네임으로 갱신
  - 성공 메시지 표시 (선택적)
  - 새 닉네임 입력 필드 초기화 (선택적)

---

## 유저플로우 #21: 로그아웃 (마이페이지)

### 1. 입력
- 로그인 사용자가 마이페이지에서 '로그아웃' 버튼 클릭

### 2. 처리
1. Supabase Auth 로그아웃 API 호출
2. 세션 정보 삭제
3. 로그아웃 실패 시 → 오류 처리

### 3. 출력
- **로그아웃 성공 시**: 로그인 페이지(`/login`)로 리다이렉트
- **로그아웃 실패 시**: 오류 메시지 표시
